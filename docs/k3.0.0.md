<br/>

!> [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://nlog-project.org/config/?tab=layout-renderers ':target=_blank')

## ✴ 基础变量 :id=H2_1

### \- ☢ ${ var } 变量定义 :id=H2_1_3_1

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${var:name=String:default=String|Layout}
>
>```
>
>---
>
>```xml
><nlog>
>
>     <variable name="v1" value="admin" />
>     <variable name="v2" value="${message}" />  
>
>     <targets>
>         <target name="debug" type="Debug" layout="${var:v1} = ${var:v2}" />
>     </targets>
>
></nlog>
>
>
>```
>
>
>
><br/>

### \- 🔸 ${ logger } 日志类别 :id=H2_1_3_4

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${logger}
>
>```
>
>
>
><br/>



### \- 🔸 ${ level } 日志级别 :id=H2_1_3_2

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${level:format=Name:uppercase=true}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ format ]`格式化输出
>- `[ uppercase ]`大小写转换
>
>---
>
>```csharp
>"${level:format=Name:uppercase=true}"     // Info
>"${level:format=FullName:uppercase=true}" // Information
>
>
>```
>
>
>
><br/>



### \- 🔸 ${ message } 日志消息 :id=H2_1_3_4

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${message}
>${replace-newlines:${message}} // 删除换行符
>    
>```
>
><br/>

### \- 🔸 ${ exception } 异常信息 :id=H2_1_3_8

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- <span style='color:red'>[ 由`LogEvent`提供的异常信息 ]</span>
>
>```csharp
>${exception)
>
>```
>
>---
>
>```csharp
>"${exception)"          // System.ArgumentNullException: Value cannot be null. (Parameter '参数不能为空')
>"${exception:format=@)" // @ 将所有 Exception 属性序列化为 Json 格式
>// {
>//     "Type":"System.ArgumentNullException", 
>//     "Message":"Value cannot be null. (Parameter '参数不能为空')", 
>//     "ParamName":"参数 不能为空", 
>//     "Data":{}, 
>//     "HResult":-2147467261
>// }
>
>---------------------------
>
>Exception ex = new ExternalException("Exception with errorCode", 5000);
>
>Logger.LogError()
>     .Exception(ex)
>     .Message("This is a fluent message {Name}.", "test")
>     .Property("PropertyName", "PropertyValue")
>     .Log();
>
>
>```
>
>
>
><br/>



### \- ☢ ${ callsite } 堆栈跟踪 :id=H2_1_3_5

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${callsite:className=Boolean:fileName=Boolean:includeSourcePath=Boolean:methodName=Boolean}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ className ]`是否呈现类名
>- `[ includeNamespace ]`是否呈现命名空间
>- `[ fileName ]`是否呈现 [ 源文件名 + 行号 ] (`CallerFilePathAttribute + CallerLineNumberAttribute`)
>- `[ includeSourcePath ]`是否呈现源文件路径 (`CallerFilePathAttribute`)
>- `[ methodName ]`是否呈现方法名称 (`CallerMemberNameAttribute`)
>
>---
>
>```csharp
>"${callsite:className=true:fileName=true:includeSourcePath=true:methodName=true}" 
>// TestConsole.Program.<Main>$(C:\Users\syl88\Desktop\TestConsole\Program.cs:32)
>
>
>```
>
><span style='color:red'>⚠ 注意：此项在执行大量日志记录时将严重的性能损失 [ 因为它必须捕获每条日志消息的完整`StackTrace`]</span> [<span style='color:#008B00'>[👓 解决方案 ]</span>](https://github.com/NLog/NLog/wiki/Custom-extension-of-Logger-interface#custom-wrapper-and-callsite ':target=_blank')
>
>
>
><br/>







### \- ☢ ${ objectpath } 渲染对象属性 :id=H2_1_3_10

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>- 渲染对象属性 <span style='color:red'>[ 支持嵌套属性，不支持数组 ]</span>
>
>```csharp
>${other:objectpath=String}
>
>```
>
>---
>
>```csharp
>"${exception:objectpath=HResult}" // 5000
>
>---------------------------
>    
>Exception ex = new ExternalException("Exception with errorCode", 5000);
>int v = ex.HResult;
>logger.LogError(ex, message: "Hello World");
>
>
>```
>
>
>
><br/>



## ✴ 条件 :id=H2_2

### \- 🔸 ${ when } :id=H2_2_3_1

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- <span style='color:Blue'>[ 满足指定条件时 - 输出内部布局 ]</span>
>
>```csharp
>${when:when=Condition:inner=Layout:else=Layout}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ Condition ]`布局条件 [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/WhenEmpty-Layout-Renderer ':target=_blank')
>
>---
>
>```csharp
>"${when:when='${level}'>='Info':inner=Hello:else=Word}" // Hello
>
>
>```
>
>
>
><br/>

### \- 🔸 ${ whenEmpty } :id=H2_2_3_2

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- <span style='color:Blue'>[ 内部布局产生空结果时，输出替代布局 ]</span>
>
>```csharp
>${whenEmpty:whenEmpty=Layout:inner=Layout}
>
>```
>
>
>
><br/>



## ☢ 上下文信息 :id=H2_3

### \- 🔸 ${ all-event-properties } 上下文数据 :id=H2_3_3_1

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- 记录 [ 所有上下文数据 ] <span style='color:Blue'>[ 包含：消息模板占位符变量 +`.Property( ... )`]</span>
>
>```csharp
>${all-event-properties:format=String:separator=String:includeEmptyValues=boolean:includeScopeProperties=boolean}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ separator ]`属性分隔符 [ 默认`,`]
>- `[ exclude ]`要排除的属性 (`P1, P2 ...`)
>- `[ includeScopeProperties ]`是否包含`${scopeproperty}` [ 默认`false`]
>
>---
>
>```csharp
>"${all-event-properties}" // v1=张三, v2={ Name = 张三, Age = 20 }, P3=属性1, P4=属性2, P1=属性1, P2=属性2
>
>Logger.Logger.PushScopeProperties(new Dictionary<string, object> { { "P1", "属性1" }, { "P2", "属性2" } });
>{
>     Logger.LogInformation()
>           .Message("{v1}：{v2}", "张三", new { Name= "张三", Age = 20 })
>           .Property("P3", "属性1")
>           .Property("P4", "属性2")
>           .Log();
>}
>
>
>```
>
>
>
>
>
><br/>

### \- 🔸 ${ event-properties } 上下文数据( 单个属性 ) :id=H2_3_3_2

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- 记录 [ 所有上下文数据 ] <span style='color:Blue'>[ 包含：消息模板占位符变量 +`.Property( ... )`]</span> [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/EventProperties-Layout-Renderer ':target=_blank')
>
>```csharp
>${event-properties:item=String:culture=String:format=String:objectpath=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ item ]`属性名称
>- `[ ignoreCase ]`属性名称是否区分大小写 [ 默认`false`]
>- `[ objectpath ]`属性为对象时候 [ 可指定对象路径 ]
>
>---
>
>```csharp
>"${event-properties:item=P1:objectpath=Name}" // 张三
>
>Logger.LogInformation()
>       .Property("P1", new { Name= "张三", Age = 20 })
>       .Log();
> 
> 
> ```
>
>
>
>
>
><br/>

### \- ☢ ${ scopenested } 上下文范围 :id=H2_3_3_3

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>-  [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/ScopeNested-Layout-Renderer ':target=_blank')
>
>```csharp
>${scopenested:bottomFrames=Integer:topFrames=Integer:separator=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ separator]`分隔符
>- `[ format ]`格式化(`format=@`将格式化为`JSON.Array`)
>
>---
>
>```csharp
>// bc337acd44d84204892519d66316fe42
>// bc337acd44d84204892519d66316fe42 7344e0697ce2419b8f2b14dc37df7ac2
>"${scopenested}" 
>
>using (Logger.Logger.PushScopeNested(Guid.NewGuid().ToString("N"))) // .BeginScope(Guid.NewGuid().ToString("N"))
>{
>    
>      Logger.LogInformation()
>            .Log();
>
>      using (Logger.Logger.PushScopeNested(Guid.NewGuid().ToString("N")))
>      {
>           Logger.LogInformation()
>                 .Log();
>      }
>    
>}
>
>
>```
>
>
>
>
>
><br/>

## ✴ 日期时间 :id=H2_4

### \- 🔸 ${ longdate } 日期时间 :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${longdate:format=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ format ]`日期格式化
>
>---
>
>```csharp
>"${longdate:format=yyyy-MM-dd HH\\:mm\\:ss}" // 2024-10-18 10:41:49.0071
>
>    
>```
>
>
>
><br/>

### \- 🔸 ${ shortdate } 日期 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${shortdate:format=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ format ]`日期格式化
>
>---
>
>```csharp
>"${shortdate:format=yyyy-MM-dd}" // 2024-10-18
>
>    
>```
>
>
>
><br/>

### \- 🔸 ${ time } 时间 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${time:format=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ format ]`日期格式化
>
>---
>
>```csharp
>"${time}" // 10:41:49.0071
>
>    
>```
>
>
>
><br/>

### \- 🔸 ${ ticks } 时间戳 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${ticks}
>
>```
>
><br/>



## ✴ 其他变量 :id=H2_5

### \- 🔸 ${ newline } 换行 :id=H2_1_3_7

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${newline}
>
>```
>
>
>
><br/>

### \- 🔸 ${ literal } 转义 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${literal:text=String}
>
>```
>
>---
>
>```csharp
>"${literal:text=Hello ${ Word }}" // Hello ${ Word }
>
>```
>
>
>
><br/>

### \- 🔸 ${ counter } 计数器 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${counter:increment=Integer:sequence=String:value=Integer}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ increment ]`计数器每次累加 [ 默认`1`]
>- `[ value ]`计数器初始值 [ 默认`1`]
>
><br/>

### \- 🔸 ${ sequenceid } 日志序号 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- 日志序列<span style='color:red'> [ 在应用程序重新启动时重置为零 ]</span>
>
>```csharp
>${sequenceid}
>
>```
>
>
>
><br/>



### \- 🔸 ${ guid } UUID :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${guid:format=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ format ]`默认格式化为`Guid.ToString("N")`
>
><br/>



## ☢ 字符串函数 :id=H2_6

### \- ☢ ${  format=@ } 使用`JSON`格式显示 :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${other:format=@}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ jsonEncode ]`是否已`JSON`格式显示内容
>
>---
>
>```csharp
>"${event-properties:item=P1}"          // { Name = 张三, Age = 20 }
>"${event-properties:item=P1:format=@}" // { "Name":"张三", "Age":20 }
>    
>Logger.LogInformation()
>      .Property("P1", new { Name = "张三", Age = 20 })
>      .Log();
>
>
>```
>
>
>
><br/>

### \- 🔸 ${ lowercase } 字符串小写 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${lowercase:lowercase=Boolean:inner=Layout:culture=Culture}
>${other:lowercase=Boolean}
>
>```
>
>---
>
>```csharp
>${level:lowercase=true}
>
>
>```
>
>
>
><br/>

### \- 🔸 ${ uppercase } 字符串大写 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${uppercase:lowercase=Boolean:inner=Layout:culture=Culture}
>${other:uppercase=Boolean}
>
>```
>
><br/>

### \- 🔸 ${ pad } 字符串填充 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${pad:padCharacter=Char:padding=Integer:inner=Layout}
>${other:padding=5}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ padCharacter ]`填充字符 [ 默认空格 ]
>- `[ padding]`字符串长度<span style='color:red'> [ 正数左填充，负数右填充 ]</span>
>
>---
>
>```csharp
>"${level:padding=-20:padCharacter=*}" // Info****************
>    
>    
>```
>
>
>
><br/>



### \- ☢ ${ replace-newlines } 删除换行符 :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${replace-newlines:inner=Layout:replacement=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ replacement ]`将 [ 换行符 ] 替换成指定字符 <span style='color:Blue'>[ 默认空格 ]</span>
>
>---
>
>```csharp
>"${message}"
>// Hello
>// Word
>    
>"${replace-newlines:${message}}" //Hello Word
>
>Logger.LogInformation()
>       .Message("Hello\nWord")
>       .Log();
>
>
>```
>
>
>
><br/>

### \- ☢ ${ trim } 删除首尾空格 :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${trim-whitespace:trimWhiteSpace=Boolean:inner=Layout}
>${other:trimWhiteSpace=Boolean}
>
>
>```
>
>---
>
>```csharp
>"${replace-newlines:${message:trimWhiteSpace=true}}"
>
>
>```
>
>
>
><br/>



## ☢ 环境相关 :id=H2_7

```csharp
<extensions>
    <add assembly="NLog.Extensions.Logging"/>
</extensions>
      
      
```

### \- ☢ ${ configsetting } 读取 `IConfiguration`  :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>[<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/ConfigSetting-Layout-Renderer ':target=_blank')
>
>```csharp
>${configsetting:item=String:default=String}
>
>
>```
>
>---
>
>```csharp
>"${configsetting:item=Name}"              // 张三
>"${configsetting:item=ContactInfo.Email}" // 13810000000@qq.com
>    
>var source = new Dictionary<string, string>
>{
>      ["Name"] = "张三",
>      ["ContactInfo:Email"] = "13810000000@qq.com",
>};
>IConfigurationRoot root = new ConfigurationBuilder()
>                              .AddInMemoryCollection(source)
>                              .Build();
>
>
>```
>
>⚠ 方式1`NLog.Extensions.Logging.ConfigSettingLayoutRenderer.DefaultConfiguration = config;`
>
>⚠ 方式2`NLog.Extensions.Hosting + NLog.Web.AspNetCore`
>
>
>
><br/>



### \- 🔸 ${ environment } 环境变量 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>
>
>```csharp
>${environment:variable=String}
>
>```
>
><br/>

### \- 🔸 ${ hostname } 服务器 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>
>
>```csharp
>${hostname}
>${machinename}
>
>```
>
><br/>

### \- 🔸 ${ local-ip } 服务器IP :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${local-ip:cachedSeconds=60}
>
>```
>
><br/>

### \- 🔸 ${ processname } 应用程序进程 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${processid}                    // 进程标识
>${processname:fullName=Boolean} //进程名称
>
>```
>
><br/>

### \- 🔸 ${ threadname } 应用程序线程 :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>```csharp
>${threadid}
>${threadname}
>
>```
>
><br/>

## ☢ 文件目录 :id=H2_8

### \- 🔸 ${ basedir }  :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- `AppContext.BaseDirectory`
>
>```csharp
>${basedir:dir=String:file=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ dir ]`等效于`Path.Combine()`
>- `[ file ]`等效于`Path.Combine()`
>
>---
>
>```csharp
>"${basedir}"                          // C:\Users\syl88\Desktop\TestConsole\bin\Debug\net8.0
>"${basedir:dir=FileDir}"              // C:\Users\syl88\Desktop\TestConsole\bin\Debug\net8.0\FileDir
>"${basedir:dir=FileDir:file=qq.txt}"  // C:\Users\syl88\Desktop\TestConsole\bin\Debug\net8.0\FileDir\qq.txt
>
>
>```
>
>
>
><br/>

### \- 🔸 ${ currentdir }  :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- `System.Environment.CurrentDirectory`
>
>```csharp
>${currentdir:dir=String:file=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ dir ]`等效于`Path.Combine()`
>- `[ file ]`等效于`Path.Combine()`
>
>
>
><br/>

### \- 🔸 ${ tempdir }  :id=H2_1_3_6

<br/>

>[!NOTE|style: flat|label: 简要说明 ]
>
>- 计算机临时目录
>
>```csharp
>${tempdir:dir=String:file=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ dir ]`等效于`Path.Combine()`
>- `[ file ]`等效于`Path.Combine()`
>
>
>
><br/>

### \- ☢ ${ filesystem }  :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>- 将<span style='color:red'> [ 文件名中的非法字符 ]</span> 替换为安全字符 (`默认: _`)
>
>```csharp
>${filesystem-normalize:fSNormalize=Boolean:inner=Layout}
>${other:fSNormalize=Boolean}
>
>
>```
>
><br/>



## ☢ .Net Core :id=H2_9

### \- 🔸 ${ aspnet-environment } 运行环境  :id=H2_1_3_6

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${aspnet-environment}
>
>
>```
>
><br/>

