<br/>

## ✡ ${ var } 变量定义 :id=H2_1

>[!WARNING|style: flat|label: 简要说明 ]
>
>- [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/Var-Layout-Renderer ':target=_blank')
>
>```csharp
>${var:name=String:default=String}
>
>
>```
>
><br/>

```xml
<nlog>
    <variable name="v1" value="admin" />
    <variable name="v2" value="${message}" />  

    <targets>
        <target name="debug" type="Debug" layout="${var:v1} = ${var:v2}" />
    </targets>
</nlog>


```



## ✡ ${ logger } 日志类别 :id=H2_2

>[!WARNING|style: flat|label: 简要说明 ]
>
>- [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/Logger-Layout-Renderer ':target=_blank')
>
>```csharp
>${logger:shortName=Boolean}
>
>
>```
>
>
>
><br/>



## ✡ ${ level } 日志级别 :id=H2_3

>[!WARNING|style: flat|label: 简要说明 ]
>
>- [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/Level-Layout-Renderer ':target=_blank')
>
>```csharp
>${level:format=Name:uppercase=true}
>
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ format ]`格式化输出
>- `[ uppercase ]`大小写转换
>
><br/>

```csharp
"${level:format=Name:uppercase=true}"     // Info
"${level:format=FullName:uppercase=true}" // Information


```



## ✡ ${ message } 日志消息 :id=H2_4

>[!WARNING|style: flat|label: 简要说明 ]
>
>- [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/Message-Layout-Renderer ':target=_blank')
>
>```csharp
>${message:exceptionSeparator=String:withException=Boolean:raw=Boolean}
>
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ withException]`是否同时显示 [ 消息 + 异常 ]
>- `[ exceptionSeparator]`分隔符 ( 消息 + 异常 ) [  默认`|`]
>- `[ raw ]`是否直接输出原始消息<span style='color:red'> ( 不对消息中的占位符进行格式化 )</span>
>
><br/>

```csharp
log.LogError(exception: new Exception("异常信息"),message: "测试消息: 姓名 {Name}, 年龄 {Age}", "张三", 30);

"${message:withException=true:raw=true}"    // "测试消息: 姓名 {Name}, 年龄 {Age}|System.Exception: 异常信息"
"${message:withException=false:raw=false}"  // "测试消息: 姓名 张三, 年龄 30"

    
```



## ✡ ${ longdate } 日期时间 :id=H2_5

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>- [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/Date-Layout-Renderer ':target=_blank')
>
>```csharp
>${date:universalTime=Boolean:format=String:culture=Culture}
>
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ universalTime]`是否转换`UTC`
>- `[ format ]`日期格式化(`yyyy-MM-dd HH\\:mm\\:ss.fff`)
>
>
>
><br/>

```csharp
${date:format=yyyy-MM-dd HH\\:mm\\:ss}  // "2025-10-07 15:33:43"


```



## ✡ ${ exception } 异常信息 :id=H2_6

>[!WARNING|style: flat|label: 简要说明 ]
>
>- [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/Exception-Layout-Renderer ':target=_blank')
>
>```csharp
>${exception:format=String:innerFormat=String
>            :maxInnerExceptionLevel=Integer
>            :innerExceptionSeparator=String
>            :separator=String
>            :exceptionDataSeparator=string}
>
>
>```
>
><span style='color:Blue'>[ OPTIONS ]</span>
>
>- <span style='color:Blue'>`[ format ]`异常格式化</span>
>
>  \-`Message`异常消息
>
>  \-`Type`异常类型全名
>
>  \-`ShortType`异常类型名
>
>  \-`ToString`异常的`ToString()`输出
>
>  \-`Method`异常发生的方法
>
>  \-`StackTrace`堆栈信息
>
>  \-`Data`异常数据字典
>
>  \-`Source`异常来源
>
>  \-`TargetSite`异常目标方法
>
>  \-`HResult`异常`HRESULT`
>
>  \-`Properties`异常的附加属性
>
>  \-`@`所有属性序列化为`JSON`
>
>  <br/>
>
>- `[ flattenException ]`是否自动展开`AggregateException`<span style='color:Blue'>( 默认：`true`)</span>
>
>- `[ innerExceptionSeparator ]`内部异常之间的分隔符 <span style='color:Blue'>( 默认：换行 )</span>
>
><br/>
>
>---
>
>```csharp
>AggregateException exception = new AggregateException(
>     "外层异常",
>     new Exception("内层异常")
>);
>log.LogError(exception: exception);
>
>"${exception}"          // "System.Exception: 内层异常"
>"${exception:format=@)" // "{\"Type\":\"System.Exception\", \"Message\":\"内层异常\", \"Data\":{}, \"HResult\":-2146233088}"
>
>
>```
>
>
>
><br/>



## ✡ ${ callsite } 堆栈跟踪 :id=H2_7

>[!WARNING|style: flat|label: 简要说明 ]
>
>```csharp
>${callsite:className=Boolean:fileName=Boolean:includeSourcePath=Boolean:methodName=Boolean}
>
>
>```
>
><span style='color:red'>⚠ 禁用：因性能影响，请使用自定义属性</span> [<span style='color:#008B00'>[👓 解决方案 ]</span>](https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/attributes/caller-information ':target=_blank')
>
>
>
><br/>





## ☢ ${ activity } 活动跟踪 :id=H2_8

>[!WARNING|style: flat|label: 简要说明 ]
>
>-  [<span style='color:#008B00'>[👓 Activity ]</span>](https://pl06972515.github.io/DOCS12/#/t8.0.0 ':target=_blank') [<span style='color:#008B00'>[👓 NLog.DiagnosticSource ]</span>](https://github.com/NLog/NLog.DiagnosticSource ':target=_blank')
>
>```csharp
>${activity:property=String}
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ SourceName ]`与此活动关联的活动源的名称
>
>- `[ TraceId ]`跟踪标识
>- `[ SpanId]`当前活动操作标识
>- `[ OperationName ]`当前活动的操作名称
>- `[ ParentId ]`父活动标识
>- -
>- `[ StartTimeUtc ]`操作开始时间
>- `[ Duration ]`操作持续时间 (`TimeSpan`)
>- `[ DurationMs ]`操作持续时间 (`TimeSpan.TotalMilliseconds`)
>- -
>- `[ TraceState ]`跟踪状态标头(`W3C`)
>- `[ TraceStateString ]`跟踪状态标头(`W3C`)
>
><br/>





## ☢ ${ all-event-properties } 上下文数据 :id=H2_9

>[!WARNING|style: flat|label: 简要说明 ]
>
>- 记录上下文数据 [<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/All-Event-Properties-Layout-Renderer  ':target=_blank')
>
>```csharp
>${all-event-properties:format=String:separator=String:includeEmptyValues=boolean:includeScopeProperties=boolean}
>
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ separator ]`属性分隔符 [ 默认`,`]
>- `[ exclude ]`要排除的属性 (`P1, P2 ...`)
>- `[ includeScopeProperties ]`是否包含`${scopeproperty}` [ 默认`false`]
>
><br/>

```csharp
public record NetWorkInfo(
       string IPAddress,
       int Port);

public static partial class Log
{

     [LoggerMessage(EventId = 0,
                    Level = LogLevel.Information,
                    Message = "Can not open SQL connection {err}")]
     public static partial void Log_Message(this ILogger logger, string err, NetWorkInfo workInfo, Exception? exception = null);


}


log.Log_Message("测试消息", new NetWorkInfo("127.0.0.1", 7777));

----------------------------
    
# ${all-event-properties}
  "err=测试消息, workInfo=NetWorkInfo { IPAddress = 127.0.0.1, Port = 7777 }"


```



## ☢ ${ event-properties } 上下文数据( 单个属性 ) :id=H2_10

<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>- 支持`:format=@`将转换格式`JSON`[<span style='color:#008B00'>[👓 官方说明 ]</span>](https://github.com/NLog/NLog/wiki/EventProperties-Layout-Renderer ':target=_blank')
>
>```csharp
>${event-properties:item=String:culture=String:format=String:objectpath=String}
>
>
>```
>
><span style='color:Blue'>[ OPTIONS  ]</span>
>
>- `[ item ]`属性名称
>- `[ ignoreCase ]`属性名称是否区分大小写 [ 默认`false`]
>- `[ objectpath ]`属性为对象时候 [ 可指定对象路径 ]
>
><br/>

```csharp
public record NetWorkInfo(
       string IPAddress,
       int Port);

public static partial class Log
{

     [LoggerMessage(EventId = 0,
                    Level = LogLevel.Information,
                    Message = "Can not open SQL connection {err}")]
     public static partial void Log_Message(this ILogger logger, string err, NetWorkInfo workInfo, Exception? exception = null);


}


log.Log_Message("测试消息", new NetWorkInfo("127.0.0.1", 7777));

----------------------------
    
# ${event-properties:item=workInfo}
  "NetWorkInfo { IPAddress = 127.0.0.1, Port = 7777 }"

# ${event-properties:item=workInfo:format=@}
  "{\"IPAddress\":\"127.0.0.1\", \"Port\":7777}"
      
# ${event-properties:item=workInfo:objectpath=IPAddress}
  "127.0.0.1"

    
```

